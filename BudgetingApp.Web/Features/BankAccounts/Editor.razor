@using BudgetingApp.Data.Models
@using MudBlazor
@inject IMediator Mediator

<MudContainer MaxWidth="MaxWidth.Medium">
    <MudTextField @bind-Value="Model.Name" Label="Name" Variant="Variant.Filled" FullWidth="true" />
    <MudTextField @bind-Value="Model.AccountNumber" Label="Acct Number" Variant="Variant.Filled" FullWidth="true" />
    <MudSelect @bind-Value="SelectedBank" Label="Bank" Variant="Variant.Outlined" FullWidth="true">
        @foreach (var itm in Model.BankList)
        {
            <MudSelectItem Value="itm">@itm.Name</MudSelectItem>
        }
    </MudSelect>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Save">Save</MudButton>
    <MudButton Variant="Variant.Text" Color="Color.Secondary" OnClick="Cancel">Cancel</MudButton>
</MudContainer>

@code {
    [CascadingParameter]
    IMudDialogInstance MudDialog { get; set; } = default!;

    [Parameter]
    public int? BankAccountId { get; set; }

    private SaveCommand Model { get; set; } = new();
    private Bank SelectedBank { get; set; } = null;

    protected override async Task OnInitializedAsync()
    {
        Model = await Mediator.Send(new SaveQuery { BankAccountId = BankAccountId });
    }

    private async Task Save()
    {
        Model.BankId = SelectedBank.BankId;
        await Mediator.Send(Model);

        MudDialog.Close(DialogResult.Ok(true));
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }
}